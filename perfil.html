<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Perfil</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- MENU SUPERIOR -->
    <nav class="menu">
        <a href="perfil.html" class="menu-btn">Palpites</a>
        <a href="simulacao.html" class="menu-btn">Simulação</a>
        <a href="classificacao.html" class="menu-btn">Classificação</a>
        <a href="artilharia.html" class="menu-btn">Artilharia</a>
        <a href="regras.html" class="menu-btn">Regras</a>
        <button id="logoutBtn" class="menu-btn logout-btn">Logout</button>
    </nav>

    <div class="container">
        <h1>Meu Perfil</h1>

        <!-- Aqui será mostrado o username -->
        <p id="nome-usuario" style="font-size: 1.2rem; color: #fff;">Carregando usuário...</p>
    </div>

    <!-- SUPABASE -->
    <script type="module">
        import { createClient } from "https://esm.sh/@supabase/supabase-js";

        const SUPABASE_URL = "https://mdaqzciffsgupzbfxzgf.supabase.co";
        const SUPABASE_ANON_KEY = "sb_publishable_5A4XlgwAjib2nde_qe5WQA_F9qCTghY";

        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // ---------------------------
        // 1. Verificar se está logado
        // ---------------------------
        const {
            data: { session }
        } = await supabase.auth.getSession();

        if (!session) {
            // não logado → volta para index
            window.location.href = "index.html";
        }

        const user = session.user;
        const userId = user.id;

        // ---------------------------
        // 2. Pegar username da URL
        // ---------------------------
        const params = new URLSearchParams(window.location.search);
        let username = params.get("username");

        // Se não veio username na URL, buscar no Supabase
        if (!username) {
            const { data } = await supabase
                .from("usuarios")
                .select("username")
                .eq("user_id", userId)
                .maybeSingle();

            if (data) {
                username = data.username;
            }
        }

        // Exibir o username na tela
        document.getElementById("nome-usuario").textContent =
            username ? `Olá, ${username}!` : "Usuário carregado";

        // ---------------------------
        // 3. Logout
        // ---------------------------
        document.getElementById("logoutBtn").addEventListener("click", async () => {
            await supabase.auth.signOut();
            window.location.href = "index.html";
        });

    </script>

</body>
</html>


